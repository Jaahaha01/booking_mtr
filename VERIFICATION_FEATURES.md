# ฟีเจอร์การยืนยันตัวตนและการจอง (Identity Verification & Booking System)

## ภาพรวม
ระบบได้ปรับปรุงการทำงานใหม่ดังนี้:
- **สมัครแล้วล็อกอินได้เลย** - ไม่ต้องรอแอดมินอนุมัติ
- **จองต้องยืนยันตัวตน** - ต้องยืนยันตัวตนก่อนจึงจะจองได้
- **จองแล้วได้สถานะรอดำเนินการ** - ต้องให้แอดมินอนุมัติการจอง

## สถานะการยืนยันตัวตน

### 1. ยังไม่ยืนยันตัวตน (สีแดง)
- แสดงเมื่อผู้ใช้ยังไม่ได้ยืนยันตัวตน
- ผู้ใช้จะเห็นปุ่ม "ยืนยันตัวตน" ในหน้าโปรไฟล์
- ไม่สามารถจองห้องประชุมได้

### 2. ยืนยันตัวตนแล้ว (สีเขียว)
- แสดงเมื่อผู้ใช้ยืนยันตัวตนแล้ว
- ไม่แสดงปุ่ม "ยืนยันตัวตน" ในหน้าโปรไฟล์
- สามารถจองห้องประชุมได้ (แต่ต้องรอแอดมินอนุมัติ)

## สถานะการจอง

### 1. รอดำเนินการ (Pending)
- การจองใหม่จะมีสถานะนี้
- แสดงในปฏิทินด้วยสีเหลือง
- รอการอนุมัติจากผู้ดูแลระบบ

### 2. ยืนยันแล้ว (Confirmed)
- การจองที่แอดมินอนุมัติแล้ว
- แสดงในปฏิทินด้วยสีปกติ
- สามารถใช้งานห้องประชุมได้

### 3. ปฏิเสธ (Rejected)
- การจองที่แอดมินปฏิเสธ
- ไม่แสดงในปฏิทิน
- ผู้ใช้ต้องจองใหม่

### 4. ยกเลิก (Cancelled)
- การจองที่ถูกยกเลิก
- ไม่แสดงในปฏิทิน

## ฟีเจอร์ที่เพิ่มเข้ามา

### 1. หน้าโปรไฟล์
- แสดงสถานะการยืนยันตัวตนด้วยสีและไอคอน
- ปุ่ม "ยืนยันตัวตน" (แสดงเฉพาะเมื่อยังไม่ยืนยัน)
- ยืนยันตัวตนทันทีโดยไม่ต้องรอแอดมิน

### 2. หน้ายืนยันตัวตน
- ฟอร์มกรอกข้อมูลยืนยันตัวตน
- ตรวจสอบความถูกต้องของข้อมูล
- ยืนยันตัวตนทันทีเมื่อส่งข้อมูลสำเร็จ

### 3. หน้าจอง
- ตรวจสอบการยืนยันตัวตนก่อนจอง
- Popup alert แจ้งเตือนเมื่อยังไม่ได้ยืนยันตัวตน
- Countdown 3 วินาทีก่อน redirect ไปหน้ายืนยันตัวตน
- แสดงข้อความ "ส่งคำขอจองห้องประชุมสำเร็จ"

### 4. ระบบอนุมัติการจอง (สำหรับแอดมิน)
- API สำหรับอนุมัติ/ปฏิเสธการจอง
- ตรวจสอบสิทธิ์แอดมิน
- อัปเดตสถานะการจอง

## การทำงานของระบบ

### 1. ผู้ใช้ใหม่
1. ลงทะเบียนและเข้าสู่ระบบได้ทันที
2. กรอกข้อมูลส่วนตัวในหน้าโปรไฟล์
3. กดปุ่ม "ยืนยันตัวตน" ในหน้าโปรไฟล์
4. กรอกข้อมูลยืนยันตัวตน (บัตรประชาชน, ที่อยู่, องค์กร)
5. ยืนยันตัวตนทันทีและสามารถจองได้

### 2. การจองห้องประชุม
- ผู้ใช้ที่ยืนยันตัวตนแล้ว: สามารถส่งคำขอจองได้
- ผู้ใช้ที่ยังไม่ยืนยัน: แสดง popup alert และ redirect ไปหน้ายืนยันตัวตน
- การจองใหม่จะมีสถานะ "รอดำเนินการ"
- รอการอนุมัติจากผู้ดูแลระบบ

### 3. การจัดการโดยผู้ดูแลระบบ
- แอดมินสามารถอนุมัติหรือปฏิเสธการจองได้
- อัปเดตสถานะการจองเป็น 'confirmed', 'rejected', หรือ 'cancelled'
- ตรวจสอบการชนกันของเวลาเฉพาะการจองที่ยืนยันแล้ว

## การอัปเดตฐานข้อมูล

### สำหรับฐานข้อมูลใหม่
รันไฟล์ `database.sql` เพื่อสร้างฐานข้อมูลใหม่ที่มีคอลัมน์ `verification_status`

### สำหรับฐานข้อมูลที่มีอยู่แล้ว
รันไฟล์ `update_database.sql` เพื่อเพิ่มคอลัมน์ `verification_status` และอัปเดตข้อมูลที่มีอยู่

```sql
-- เพิ่มคอลัมน์ verification_status
ALTER TABLE users ADD COLUMN verification_status ENUM('pending', 'approved', 'rejected') DEFAULT NULL AFTER is_verified;

-- อัปเดตข้อมูลที่มีอยู่แล้ว
UPDATE users SET verification_status = 'approved' WHERE is_verified = TRUE;
UPDATE users SET verification_status = NULL WHERE is_verified = FALSE;
```

## ไฟล์ที่เกี่ยวข้อง

### Frontend
- `app/profile/page.tsx` - หน้าโปรไฟล์
- `app/verify/page.tsx` - หน้ายืนยันตัวตน
- `app/booking/page.tsx` - หน้าจอง

### Backend
- `app/api/verify-identity/route.ts` - API ยืนยันตัวตน
- `app/api/profile/route.ts` - API โปรไฟล์
- `app/api/bookings/route.ts` - API การจอง
- `app/api/bookings/[id]/route.ts` - API อนุมัติการจอง

### Database
- `database.sql` - สร้างฐานข้อมูลใหม่
- `update_database.sql` - อัปเดตฐานข้อมูลที่มีอยู่

## การทดสอบ

### ทดสอบการยืนยันตัวตน
1. **ยังไม่ยืนยัน**: ลงทะเบียนผู้ใช้ใหม่
2. **ยืนยันแล้ว**: ยืนยันตัวตนผ่านฟอร์ม

### ทดสอบการจอง
1. ผู้ใช้ที่ยืนยันแล้ว: ควรส่งคำขอจองได้ (สถานะ pending)
2. ผู้ใช้ที่ยังไม่ยืนยัน: ควรแสดง popup และ redirect
3. แอดมิน: ควรอนุมัติ/ปฏิเสธการจองได้

### ทดสอบการอนุมัติ
1. แอดมินเข้าสู่ระบบ
2. ดูรายการจองที่รอดำเนินการ
3. อนุมัติหรือปฏิเสธการจอง
4. ตรวจสอบการอัปเดตสถานะ
